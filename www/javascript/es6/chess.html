<html>
	<head>
	<style>
		.helpBox {
			padding: 20px;
			float: left;
			height: 40px;
			width: 400px;
			outline: none;
		}
		.chessboard {
			height: 400px;
			width: 400px;
			border: 10px #000 SOLID;
		}

		.blackSquare {
			background: #8aa;
			height: 50px;
			width: 50px;
			float: left;
		}

		.whiteSquare {
			background: #eee;
			height: 50px;
			width: 50px;
			float: left;
		}

		.whiteSquareSelected {
			background: #aaa;
			height: 50px;
			width: 50px;
			float: left;
		}

		.blackSquareSelected {
			background: #699;
			height: 50px;
			width: 50px;
			float: left;
		}
	</style>
		<script type="text/javascript">
			document.onreadystatechange = () => {
				if ( document.readyState === "complete" ) {
					myApp("Chessboard")
				}
			}

			//This is cleaner. Remove element if it already exists.
			class DOMElement {

				attr
				elemType
				elem

				constructor(e, a) {
					this.attr = a
					this.elem = document.createElement(e)
				}

				attachTo(c) {

					if ( this.elem !== null ) {
						let e = this.elem
						if ( e.parentNode !== null ) {
							e.parentNode.removeChild(e)
						}
						for ( let prop in this.attr ) {
							e.setAttribute(prop, this.attr[prop])
						}
						//Finally attach element
						c.elem.appendChild(e)
					}

				}

				refresh(attr) {
					for ( let prop in attr ) {
						this.elem.removeAttribute(prop)
						this.elem.setAttribute(prop, attr[prop])
						this.attr[prop] = attr[prop]
					}
				}

			}

			class Square extends DOMElement {
				color
				isSelected

				constructor(id, color) {
					super("div", { "id" : "square#"+id, "class" : color+"Square" })
					this.color = color
					this.isSelected = false
				}

				attachTo(c) {
					//Places square inside container element c ( which is chessboard here)
					super.attachTo(c)

				}

				selectedEvent(selectEventHandler) {
					this.elem.onclick = () => {
						selectEventHandler(this)
					}
				}

			}

			class Chessboard extends DOMElement {
				id
				squares
				helpBox

				constructor(id) {
					super("div", { id: id, class : "chessboard" })
					this.id = id
					this.squares = new Array()
					this.helpBox = new HelpBox("helpBox")
					let c = [ "white", "black" ]
					//Add squares to chessboard in right order, let css take care of placement.
					for ( let i = 7 ; i >= 0 ; i-- ) {
						for ( let j = 1 ; j <= 8 ; j++ ) {
						this.squares.push(new Square(i*8+j, c[(j+i%2)%2]))
						}
					}
				}

				attachTo(c) {

					//Create chessboard and place squares in it.
					super.attachTo(c)

					//Render squares
					for ( let s of this.squares ) {
						s.attachTo(this)
					}

					//Add helper box
					this.helpBox.attachTo(this)
					//No action defined yet
					this.elem.onclick = () => {
					}

				}

				squareSelectedEvent(selectEventHandler) {
					for ( let s of this.squares ) {
						s.selectedEvent(selectEventHandler)
					}
				}
			}

			class HelpBox extends DOMElement {

				value

				constructor(id) {
					super("div", { id: id, class: "helpBox", disabled: true })
					this.value = "Click to select or unselect square"
					this.elem.innerHTML = this.value
				}

				attachTo(c) {
					super.attachTo(c)
				}
			}

			const myApp = (msg) => {
				console.log(msg+" creating...")

				var selectedSquare = new Array()

				//Event handler onClick for squares on chessboard
				selectEventHandler = (selectedSquareObject) => {
					const squareColor = { false: "Square" , true: "SquareSelected"} 
						if (selectedSquare.length != 0) { 
							const previousSelectedSquareObject = selectedSquare.pop()
							if (previousSelectedSquareObject !== selectedSquareObject) {
								previousSelectedSquareObject.isSelected = false
								previousSelectedSquareObject.refresh({class : previousSelectedSquareObject.color+squareColor[previousSelectedSquareObject.isSelected]})
							}
						}
						selectedSquare.push(selectedSquareObject)
						//Toggle selected state
						selectedSquareObject.isSelected = !selectedSquareObject.isSelected
						//selectedSquareObject.elem.removeAttribute("class")
						//selectedSquareObject.elem.setAttribute("class", selectedSquareObject.color+squareColor[selectedSquareObject.isSelected])
					selectedSquareObject.refresh({class: selectedSquareObject.color+squareColor[selectedSquareObject.isSelected]})
				}

				const c = new Chessboard("mychessboard")
				c.attachTo({ elem : document.body })
				c.attachTo({ elem : document.body })
				//Attach click events to squares
				c.squareSelectedEvent(selectEventHandler)
				console.log(msg+" created...")
			}

		</script>
	</head>
	<body>
	</body>
</html>
